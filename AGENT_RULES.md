# Agent Rules — who-the-hell-wins

プロジェクトの目的と開発ルールをまとめたガイド。新しいエージェントや開発者はここを起点にすること。

## プロダクト概要
- テキサスホールデムのショーダウン時に、各プレイヤーのハンドとボードから最強役を判定し勝者を示す Web アプリ。
- フロントのみで完結する（当面サーバー呼び出し無し）。判定ロジックは純粋関数として実装し、テストで網羅する。

## 技術スタック
- Next.js（App Router 前提、バージョンは最新 LTS 近辺を採用）
- TypeScript（`strict` 有効）
- Tailwind CSS
- テスト: Jest + React Testing Library、役判定はユニットテスト中心。E2E は Playwright を後で追加。
- フォーマット: Prettier、静的解析: ESLint（`next`, `typescript`, `tailwindcss` プラグインを想定）
- パッケージマネージャーはデフォルトで `npm`（変更する場合はルール更新）

## 開発プロセス（TDD）
1. 失敗するテストを書く（Red）
2. 最小実装で通す（Green）
3. リファクタする（Refactor）— 可読性と設計を改善し、再度テストを回す。
4. 変更ごとに `npm test` と `npm run lint` を実行し、出力を回答に要約する。
5. 仕様追加は必ずテスト追加から始める。バグ報告は再現テスト→修正→回帰テストの順。

## 実装ルール
- **判定ロジック**: デッキ/カード/ハンド/ランク評価は副作用のない純粋関数で構成。乱数はテストでシード固定。
- **優先順位**: ロジック > アクセシビリティ > パフォーマンス > 見た目。UI はシンプルかつレスポンシブ。
- **型設計**: `Card`, `Hand`, `Board`, `Rank`, `Result` などのドメイン型を明示。文字列の生値より `enum`/`union` を使用。
- **コンポーネント**: デフォルトはサーバーコンポーネント。状態やイベントが必要な場合のみ `\"use client\"`。
- **Tailwind**: 共通色・余白は `tailwind.config` のカスタムトークンに寄せる。ユーティリティクラスの長文化を避け、複雑なら小さなコンポーネントへ分割。
- **アクセシビリティ**: フォーム要素はラベル必須、結果表示はスクリーンリーダー向けテキストを用意。

## コーディング規約
- 命名は英語、ポーカー用語は一般的な単語を採用（例: `flush`, `straight`, `fullHouse`）。略語を避ける。
- 早期リターンでネストを浅く保つ。マジックナンバーは定数化。
- コメントは必要最小限で、意図や非自明なアルゴリズムに限る。

## テスト方針
- ハンド判定は組み合わせごとに代表ケースと境界ケースを用意（同値クラス+境界値）。
- 回帰テストを兼ねるフィクスチャを `tests/fixtures` にまとめる。
- E2E は「プレイヤー数変更→手札入力→勝者表示」のハッピーパスと、入力バリデーションの異常系を用意（後で実装）。

## リポジトリ運用
- ブランチ名: `feature/<topic>` / `fix/<topic>`。コミットメッセージは簡潔（Conventional Commits 推奨）。
- `.env*` はコミット禁止。必要なキーは `.env.example` で明示。
- 依存追加は理由を記述（テスト用途か本番か）し、`devDependencies` と `dependencies` を分ける。

## エージェント実行ポリシー
- 破壊的コマンド（`git reset --hard`, `rm -rf` 等）は実行しない。
- ファイル検索は `rg` を優先。大規模変更は `apply_patch` で最小差分を心掛ける。
- 変更後は関係テストを走らせ、結果要約をレスポンスに含める（実行できない場合は理由と推定影響を述べる）。

## 近日の初期タスク（案）
- Next.js + TS + Tailwind の初期セットアップ（App Router / ESLint / Prettier）。
- 判定エンジンの型スケッチとレッドテスト作成（役優先順位の表現を決める）。
- ハッピーパス UI のラフ（手札入力→結果表示のモック）とスナップショットテスト。

このファイルはルール変更や決定事項があれば適宜更新すること。
